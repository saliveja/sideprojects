(self.webpackChunklite=self.webpackChunklite||[]).push([[9712],{23370:(e,n,t)=>{"use strict";t.d(n,{T:()=>r});var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CreateUserDomainMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"domain"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userDomainLink"},arguments:[{kind:"Argument",name:{kind:"Name",value:"domain"},value:{kind:"Variable",name:{kind:"Name",value:"domain"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CustomDomainFailure"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"reason"}}]}}]}}]}}]}},99712:(e,n,t)=>{"use strict";t.d(n,{h:()=>le,k:()=>oe});var r,a=t(28655),i=t.n(a),l=t(63038),o=t.n(l),u=t(71439),c=t(67294),s=t(90833),m=t(46829),d=t(58875),p=t.n(d),f=t(6443),g=t(77355),h=t(93310),v=t(87691),E=t(18627),x=t(14646),b=t(21121),k=t(46696),y=function(e){return{backgroundColor:e.baseColor.background.light,borderColor:e.baseColor.border.light,borderRadius:"3px",borderWidth:"1px",alignItems:"center",padding:"25px 20px 25px 20px",marginTop:"",borderStyle:"solid"}},I=function(){var e=(0,x.I)();return c.createElement("div",{className:e([S,y])},c.createElement(g.x,{textAlign:"center"},c.createElement(g.x,null,"1000 x 1000"),c.createElement(g.x,null,"pixels")))},C=function(){return c.createElement(g.x,{marginRight:"5px",display:"inline-block"},c.createElement(v.F,{scale:"S",color:"ERROR"},"That file doesn't meet our requirements. Try another."))},w=function(){return c.createElement(g.x,{marginTop:"8px"},c.createElement(g.x,{marginRight:"5px",display:"inline-block"},c.createElement(v.F,{scale:"S",color:"ERROR"},"We couldn't process your request.")),c.createElement(g.x,{marginRight:"5px",display:"inline-block"},c.createElement(v.F,{scale:"S"},"Try again, or"," ",c.createElement(h.r,{inline:!0,linkStyle:"OBVIOUS",href:"https://help.medium.com/hc/en-us"},"search our help center for support."))))};!function(e){e.Success="success",e.UploadError="uploadError",e.InvalidError="invalidError"}(r||(r={}));var S={height:"132px",width:"132px",display:"flex",flexDirection:"row",justifyContent:"center"},D=function(e){var n=e.setImageId,t=e.initialImageId,a=e.source,i=(0,x.I)(),l=(0,E.Av)(),u=(0,f.H)().value,s=c.useState({imageId:t,imageWidth:0,imageHeight:0}),m=o()(s,2),d=m[0],p=m[1],v=c.useState(null),y=o()(v,2),D=y[0],T=y[1],R=function(e){T(e),l.event("user.updateAvatarResult",{userId:null==u?void 0:u.id,source:a,uploadResult:e})},L=(0,b.JA)((function(e,t,a){var i=t.height,l=t.width,o=e.value.fileId;p({imageId:o,imageHeight:i,imageWidth:l}),i<parseInt("1000px",10)||l<parseInt("1000px",10)?(R(r.InvalidError),A()):(n(o),R(r.Success),a())}),(function(){R(r.UploadError)}),(function(){R(r.InvalidError)})),N=L.inputRef,U=L.fireClick,O=function(){l.event("user.updateAvatarClick",{userId:null==u?void 0:u.id,source:a,hasImage:!!d.imageId}),U()},A=function(){p({imageId:"",imageWidth:0,imageHeight:0}),n("")},P=c.useCallback((function(){return c.createElement(g.x,{marginBottom:"10px"},c.createElement("input",{type:"file","aria-hidden":"true",ref:N,className:i({display:"none"})}),c.createElement(h.r,{inline:!0,linkStyle:"OBVIOUS",onClick:O},"Add photo"))}),[i,O,N]),F=c.useCallback((function(){return c.createElement("div",{className:i([S])},c.createElement("div",{className:i((function(){return{backgroundImage:"url(".concat((0,k.W6)({miroId:d.imageId||"",width:d.imageWidth||0,height:d.imageHeight||0}),")"),backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"contain",height:"100%",width:"100%",borderRadius:"3px",display:"flex",flexDirection:"row"}}))}))}),[i,d]),B=c.useCallback((function(){return c.createElement(g.x,{display:"inline-block",marginBottom:"15px"},d.imageId?c.createElement(F,null):c.createElement(I,null))}),[d]);return c.createElement(g.x,{display:"flex",flexDirection:"column",maxWidth:"132px"},c.createElement(g.x,{display:"inline-block",float:"right"},c.createElement(B,null)),c.createElement(P,null),D===r.UploadError&&c.createElement(w,null),D===r.InvalidError&&c.createElement(C,null))},T=t(31708),R=function(e){var n=e.label,t=e.onChangeFn,r=e.onBlurFn,a=e.value,i=e.errorMessage,l=e.characterCountLimit;return c.createElement(c.Fragment,null,c.createElement(g.x,{marginBottom:"15px",textAlign:"left"},c.createElement(v.F,{scale:"L",tag:"h4"},n)),c.createElement(T.n,{scale:"L",onChange:t,value:a,errorMessage:i,onBlur:r,ariaLabel:n,characterCountLimit:l}))},L=t(1383),N=t(62896);function U(){var e=i()(["\n  mutation userCompleteProfileMutation(\n    $userId: ID!\n    $name: String!\n    $bio: String!\n    $imageId: String!\n  ) {\n    userCompleteProfile(userId: $userId, name: $name, bio: $bio, imageId: $imageId)\n  }\n"]);return U=function(){return e},e}function O(){var e=i()(["\n  fragment UserCompleteProfileDialog_user on User {\n    id\n    name\n    bio\n    imageId\n    hasCompletedProfile\n  }\n"]);return O=function(){return e},e}var A={min:3,max:50,message:"Please try another name that’s between 3 and 50 characters."},P={min:10,max:160,message:"Please try another description that’s between 10 and 160 characters."},F=function(e,n){var t=e.min,r=e.max,a=e.message;return function(e){var i=e.target.value;n(i.length<t||i.length>r?a:void 0)}},B=function(e){var n=(0,f.H)().value;return e?{shouldShowDialog:p().canUseDOM&&!(0,N.ic)(navigator.userAgent)&&(null==n?void 0:n.id)===e.id}:{shouldShowDialog:!1}},H=function(e){var n=e.setHasCompletedProfile,t=e.user,r=e.confirmText,a=void 0===r?"Continue":r,i=(0,E.Av)(),l=(0,f.H)().value,u=c.useState(!1),s=o()(u,2),m=s[0],d=s[1],p=V(),h=o()(p,1)[0],x=c.useState((null==t?void 0:t.imageId)||""),b=o()(x,2),k=b[0],y=b[1],I=c.useState((null==t?void 0:t.name)||""),C=o()(I,2),w=C[0],S=C[1],T=c.useState((null==t?void 0:t.bio)||""),N=o()(T,2),U=N[0],O=N[1],H=c.useState(),M=o()(H,2),G=M[0],W=M[1],_=c.useState(),$=o()(_,2),j=$[0],z=$[1],J=F(A,W),Q=F(P,z),q=c.useCallback((function(){l&&(d(!0),i.event("user.completedProfile",{userId:l.id,changedName:(null==t?void 0:t.name)!==w,changedBio:(null==t?void 0:t.bio)!==U,changedImage:(null==t?void 0:t.imageId)!==k,hasName:!!w,hasBio:!!U,hasImage:!!k}),h({variables:{userId:l.id,name:w,bio:U,imageId:k}}).then((function(){d(!1),n(!0)})))}),[l,h,d,t,w,U,k]),X=B(t).shouldShowDialog;return c.useEffect((function(){X&&i.event("user.presentedCompleteProfileDialog",{userId:null==l?void 0:l.id})}),[X]),X?c.createElement(c.Fragment,null,c.createElement(L.Q,{confirmText:a,titleText:"Complete your profile",isDestructiveAction:!1,onConfirm:q,isVisible:!0,hide:function(){},withCloseButton:!1,showCancelButton:!1,disableConfirm:m},c.createElement(v.F,{scale:"L",color:"DARKER"},"Readers like learning a bit more about their writers"),c.createElement(g.x,{marginTop:"48px",marginBottom:"28px",display:"flex",flexDirection:"row"},c.createElement(g.x,{overflow:"visible",maxHeight:"200px"},c.createElement(D,{setImageId:y,initialImageId:k,source:"userCompleteProfileDialog"})),c.createElement(g.x,{marginLeft:"48px",textAlign:"left"},c.createElement(g.x,{key:"name"},c.createElement(R,{label:"Full name",onChangeFn:function(e){return S(e.target.value)},onBlurFn:J,value:w,errorMessage:G})),c.createElement(g.x,{key:"bio",marginTop:"40px"},c.createElement(R,{label:"Bio (optional, max 160 characters)",onChangeFn:function(e){return O(e.target.value)},onBlurFn:Q,value:U,errorMessage:j,characterCountLimit:160})))))):null},M=(0,u.Ps)(O()),V=function(){return(0,m.useMutation)(G)},G=(0,u.Ps)(U()),W=t(23279),_=t.n(W),$=t(23370),j=t(47230),z=t(43487),J=t(27232),Q=t(68894),q=t(50458);function X(){var e=i()(["\n  query userDomainValidityQuery($domain: String!) {\n    userDomainValidity(domain: $domain)\n  }\n"]);return X=function(){return e},e}function Y(){var e=i()(["\n  fragment UserSubdomainOnboardingDialog_user on User {\n    id\n    customDomainState {\n      pending {\n        status\n      }\n      live {\n        status\n      }\n    }\n    username\n  }\n"]);return Y=function(){return e},e}var K=function(e){var n,t,r=e.user,a=e.isVisible,i=e.hide,l=e.redirectTo,u=e.redirectOnHide,s=void 0!==u&&u,d=e.refreshOnHide,h=void 0!==d&&d,b=e.redirectToUrl,k=(0,x.I)(),y=(0,E.Av)(),I=(0,f.H)().value,C=null!=I&&I.username?(0,J.w)(I.username):"",w=c.useState(C),S=o()(w,2),D=S[0],R=S[1],N=(0,Q.O)(!1),U=o()(N,3),O=U[0],A=U[1],P=U[2],F=c.useState(!1),B=o()(F,2),H=B[0],M=B[1],V=c.useState(!1),G=o()(V,2),W=G[0],X=G[1],Y=te(D),K=re(D),Z=c.useState(null),ne=o()(Z,2),ae=ne[0],ie=ne[1],le=(0,z.v9)((function(e){return e.config.productName})),oe=(0,m.useMutation)($.T),ue=o()(oe,1)[0],ce=ee(Y),se=ce.isValidityLoading,me=ce.validityResult,de=ce.checkValidity,pe=c.useCallback(_()((function(e){de(e),M(!1)}),500),[]),fe=c.useCallback((function(e){var n=e.target.value;H||M(!0),ie(null),pe({domain:n}),R(n)}),[de,H]),ge=c.useCallback((function(){X(!0),y.event("user.claimedSubdomain",{userId:null==I?void 0:I.id,source:"subdomain_dialog",changedUsername:(null==I?void 0:I.username)!==D}),ue({variables:{domain:Y}}).then((function(e){var n,t,r,a,l="Something went wrong. Please try again with a different name.";if("CustomDomain"===(null===(n=e.data)||void 0===n||null===(t=n.userDomainLink)||void 0===t?void 0:t.__typename))A(),i();else if("CustomDomainFailure"===(null===(r=e.data)||void 0===r||null===(a=r.userDomainLink)||void 0===a?void 0:a.__typename)){var o=e.data.userDomainLink.reason||l;ie(o)}else ie(l);X(!1)}))}),[ue,y,I,Y,D]),he=c.useCallback((function(){s&&l(b||K),P(),h&&window.location.reload()}),[K,s,h]),ve=!(null==r||null===(n=r.customDomainState)||void 0===n||!n.pending)||!(null==r||null===(t=r.customDomainState)||void 0===t||!t.live),Ee=!!I&&r.id===I.id&&!ve&&p().canUseDOM;if(c.useEffect((function(){a&&Ee&&y.event("user.presentedClaimSubdomainDialog",{userId:null==I?void 0:I.id})}),[a,Ee]),!Ee)return null;var xe=!H&&!se&&(null==me?void 0:me.userDomainValidity);return c.createElement(c.Fragment,null,c.createElement(L.Q,{confirmText:"Claim URL",titleText:"Claim your ".concat(le," URL"),isDestructiveAction:!1,onConfirm:ge,isVisible:a,hide:i,withCloseButton:!1,showCancelButton:!1,secondaryButton:c.createElement(j.z,{href:(0,q.mcw)(),size:"REGULAR"},"Learn More"),hideOnConfirm:!1,disableConfirm:W||!!ae||!xe},"All your stories show up on your profile, and it now comes with a personalized URL. The name you pick below will also be your username on ",le,".",c.createElement(g.x,{marginBottom:"14px",marginTop:"32px",display:"flex",flexDirection:"column"},c.createElement(T.n,{ariaLabel:"Profile domain",onChange:fe,value:D,errorMessage:null!=ae?ae:void 0,hideErrorIcon:!0}),!ae&&c.createElement(g.x,{display:"inline-block",marginTop:"8px"},c.createElement("table",{className:k({display:"table",marginLeft:"auto",marginRight:"auto",textAlign:"left",borderSpacing:"4px",tableLayout:"fixed",maxWidth:"100%"})},c.createElement("tbody",null,c.createElement("tr",null,c.createElement("td",{className:k({paddingRight:"4px",verticalAlign:"top"})},c.createElement(v.F,{color:"LIGHTER",scale:"M",tag:"h4"},c.createElement("strong",null,"URL"))),c.createElement("td",null,c.createElement(v.F,{color:"LIGHTER",scale:"M"},Y))),c.createElement("tr",null,c.createElement("td",{className:k({paddingRight:"4px",verticalAlign:"top"})},c.createElement(v.F,{color:"LIGHTER",scale:"M",tag:"h4"},c.createElement("strong",null,"Username"))),c.createElement("td",{className:k({marginBottom:"12px",marginTop:"10px"})},c.createElement(v.F,{color:"LIGHTER",scale:"M"},"@",D))),c.createElement("tr",null,c.createElement("td",null),c.createElement("td",{className:k({visibility:D===r.username?"hidden":"visible"})},c.createElement(v.F,{color:"LIGHTER",scale:"M"},"@",r.username," will no longer be valid")))))))),c.createElement(L.Q,{confirmText:"Done",titleText:"You're all set.",isDestructiveAction:!1,onConfirm:function(){},isVisible:O,hide:he,withCloseButton:!1,showCancelButton:!1},"Your profile is now available at your ",le," URL.",c.createElement(g.x,null,c.createElement(g.x,{display:"inline-block",marginTop:"28px"},c.createElement("table",{className:k({display:"table",marginLeft:"auto",marginRight:"auto",textAlign:"left",tableLayout:"fixed",maxWidth:"100%"})},c.createElement("tbody",null,c.createElement("tr",null,c.createElement("td",{className:k({marginBottom:"12px",paddingRight:"8px",verticalAlign:"top"})},c.createElement(v.F,{color:"LIGHTER",scale:"M",tag:"h4"},c.createElement("strong",null,"URL"))),c.createElement("td",null,c.createElement(v.F,{color:"LIGHTER",scale:"M",tag:"h4"},Y))),c.createElement("tr",{className:k({paddingTop:"8px"})},c.createElement("td",{className:k({paddingRight:"8px",verticalAlign:"top"})},c.createElement(v.F,{color:"LIGHTER",scale:"M",tag:"h4"},c.createElement("strong",null,"Username"))),c.createElement("td",{className:k({marginBottom:"12px"})},c.createElement(v.F,{color:"LIGHTER",scale:"M",tag:"h4"},"@",D)))))))))},Z=(0,u.Ps)(Y()),ee=function(e){var n=(0,m.useQuery)(ne,{variables:{domain:e},ssr:!1});return{isValidityLoading:n.loading,validityResult:n.data,checkValidity:n.refetch}},ne=(0,u.Ps)(X()),te=function(e){var n=(0,z.v9)((function(e){return e.config.authDomain})).split(":")[0];return"".concat(e,".").concat(n)},re=function(e){var n=(0,z.v9)((function(e){return e.config.authDomain}));return"https://".concat(e,".").concat(n)},ae=t(77280);function ie(){var e=i()(["\n  fragment UserSubdomainFlow_user on User {\n    id\n    hasCompletedProfile\n    name\n    bio\n    imageId\n    ...UserCompleteProfileDialog_user\n    ...UserSubdomainOnboardingDialog_user\n  }\n  ","\n  ","\n"]);return ie=function(){return e},e}var le=function(e){var n,t=e.user,r=e.redirectOnComplete,a=void 0!==r&&r,i=e.refreshOnComplete,l=void 0!==i&&i,u=e.forceVisible,m=void 0!==u&&u,d="true"===(0,ae.Wd)("showDomainSetup")||m,p="true"===(0,ae.Wd)("skipProfile"),f=(0,ae.Wd)("redirectToUserSettings"),g=(0,z.v9)((function(e){return e.config.authDomain})),h=(0,Q.O)(d),v=o()(h,2),E=v[0],x=v[1],b=c.useState(t.hasCompletedProfile),k=o()(b,2),y=k[0],I=k[1],C=c.useState(null),w=o()(C,2),S=w[0],D=w[1];f&&(n=(0,q.kdC)(g));var T=B(t).shouldShowDialog,R=!p&&T&&!y&&(!t.name||!t.bio||!t.imageId);return S?c.createElement(s.l,{to:S,replace:!0}):c.createElement(c.Fragment,null,c.createElement(K,{isVisible:E&&!R,hide:m?function(){}:x,user:t,redirectTo:D,redirectOnHide:a,refreshOnHide:l,redirectToUrl:n}),E&&R?c.createElement(H,{user:t,setHasCompletedProfile:I,confirmText:"Continue"}):null)},oe=(0,u.Ps)(ie(),M,Z)},27232:(e,n,t)=>{"use strict";t.d(n,{w:()=>r});var r=function(e){return e.toLowerCase().replace(/[_.]/g,"-").replace(/[^a-z0-9-]/g,"").replace(/-+/g,"-").replace(/^-/,"").replace(/-$/,"")}},21121:(e,n,t)=>{"use strict";t.d(n,{Dm:()=>r,JA:()=>x});var r,a=t(63038),i=t.n(a),l=t(87757),o=t.n(l),u=t(48926),c=t.n(u),s=t(94301),m=t.n(s),d=t(67294),p=t(92661);!function(e){e[e.NONE=0]="NONE",e[e.STARTING=1]="STARTING",e[e.UPLOADING=2]="UPLOADING",e[e.UPLOADED=3]="UPLOADED"}(r||(r={}));var f=new Set(["jpg","jpeg","png","gif"]),g=function(e){return new Promise((function(n){return setTimeout(n,e)}))},h=function(){var e=c()(o().mark((function e(n,t){var r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m()(n,{credentials:"same-origin",method:"POST",headers:{accept:"application/json","Content-Type":"application/json","x-xsrf-token":"1","X-Obvious-CID":"web"},body:JSON.stringify({url:t})});case 2:return r=e.sent,e.next=5,r.text();case 5:return a=e.sent,e.abrupt("return",JSON.parse(a.replace("])}while(1);</x>","")));case 7:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),v=function(){var e=c()(o().mark((function e(n,t){var r,a,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new FormData).append("uploadedFile",t),e.next=4,m()(n,{credentials:"same-origin",method:"POST",headers:{"x-xsrf-token":"1","X-Obvious-CID":"web"},body:r});case 4:return a=e.sent,e.next=7,a.text();case 7:return i=e.sent,e.abrupt("return",JSON.parse(i.replace("])}while(1);</x>","")));case 9:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),E="CreateUpload",x=function(e,n,t){var a=d.useState(r.NONE),l=i()(a,2),u=l[0],s=l[1],m=d.useRef(null),x=d.useCallback((function(){m.current&&m.current.click()}),[m.current]),b=(0,p.BS)(E),k=(0,p.BS)("CreateUploadUrl");function y(){return I.apply(this,arguments)}function I(){return(I=c()(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(r.STARTING),e.next=3,g(0);case 3:s(r.UPLOADING);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(){return(C=c()(o().mark((function t(a){var i,l,u,c,m;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y();case 2:if(t.prev=2,k){t.next=5;break}throw new Error("Expected ".concat(E," route to exist"));case 5:return t.next=7,h(k.pathPattern,a);case 7:l=t.sent,u=l.success,c=l.payload,u&&null!=c&&null!==(i=c.value)&&void 0!==i&&i.fileId?((m=new Image).onload=function(){s(r.UPLOADED),e(c,{url:a,height:m.height,width:m.width},(function(){return s(r.NONE)}))},m.onerror=function(){n()},m.src=a):n(),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),n();case 15:case"end":return t.stop()}}),t,null,[[2,12]])})))).apply(this,arguments)}function w(e){return S.apply(this,arguments)}function S(){return(S=c()(o().mark((function a(i){var l,u,c,m,d,p,g,h;return o().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(l=null==i?void 0:i[0]){a.next=3;break}return a.abrupt("return");case 3:if(u=l.name.split(".").pop(),f.has((null==u?void 0:u.toLowerCase())||"")){a.next=7;break}return t&&t(),a.abrupt("return");case 7:return a.next=9,y();case 9:if(a.prev=9,b){a.next=12;break}throw new Error("Expected ".concat(E," route to exist"));case 12:return a.next=14,v(b.pathPattern,l);case 14:m=a.sent,d=m.success,p=m.payload,d&&null!=p&&null!==(c=p.value)&&void 0!==c&&c.md5&&(g=URL.createObjectURL(l),(h=new Image).onload=function(){s(r.UPLOADED),e(p,{file:l,height:h.height,width:h.width},(function(){return s(r.NONE)}))},h.src=g),a.next=22;break;case 19:a.prev=19,a.t0=a.catch(9),n();case 22:case"end":return a.stop()}}),a,null,[[9,19]])})))).apply(this,arguments)}function D(){w(this.files),this.value=""}return d.useEffect((function(){if(m.current)return m.current.addEventListener("change",D),function(){m.current&&m.current.removeEventListener("change",D)}}),[m.current]),{inputRef:m,fireClick:x,status:u,handleDropEvent:function(e){var n=e.dataTransfer;n&&w(n.files)},uploadUrl:function(e){return C.apply(this,arguments)}}}}}]);
//# sourceMappingURL=https://stats.medium.build/lite/sourcemaps/9712.7bc6f8df.chunk.js.map